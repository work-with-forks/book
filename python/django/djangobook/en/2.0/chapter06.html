<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Chapter 6: The Django Admin Site</title>
    <link rel="stylesheet" href="_static/reset-min.css" type="text/css">
    <link rel="stylesheet" href="_static/grids-min.css" type="text/css">
    <link rel="stylesheet" href="_static/djangobook.css" type="text/css">
    
  </head>
  <body>
    <div id="doc" class="yui-t7">
      <div id="hd">
        <h1><a href="index.html">The Django Book</a></h1>
        <div id="global-nav">
            <a class="about" href="frontmatter.html">About</a>
        </div>
        
<div class="nav">
    
        <a href='chapter05.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='chapter07.html'>next &raquo;</a>
    
</div>

      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            
  <div id="chapter-body"><div class="section" id="chapter-6-the-django-admin-site">
<h1>Chapter 6: The Django Admin Site</h1>
<p>For a certain class of Web sites, an <em>admin interface</em> is an essential part of
the infrastructure. This is a Web-based interface, limited to trusted site
administrators, that enables the adding, editing and deletion of site content.
Some common examples: the interface you use to post to your blog, the backend
site managers use to moderate user-generated comments, the tool your clients
use to update the press releases on the Web site you built for them.</p>
<p>There&#8217;s a problem with admin interfaces, though: it&#8217;s boring to build them.
Web development is fun when you&#8217;re developing public-facing functionality, but
building admin interfaces is always the same. You have to authenticate users,
display and handle forms, validate input, and so on. It&#8217;s boring, and it&#8217;s
repetitive.</p>
<p>So what&#8217;s Django&#8217;s approach to these boring, repetitive tasks? It does it all
for you &#8211; in just a couple of lines of code, no less. With Django, building an
admin interface is a solved problem.</p>
<p>This chapter is about Django&#8217;s automatic admin interface. The feature works by
reading metadata in your model to provide a powerful and production-ready
interface that site administrators can start using immediately. Here, we discuss
how to activate, use, and customize this feature.</p>
<p>Note that we recommend reading this chapter even if you don&#8217;t intend to use the
Django admin site, because we introduce a few concepts that apply to all of
Django, regardless of admin-site usage.</p>
<div class="section" id="the-django-contrib-packages">
<h2>The django.contrib packages</h2>
<p>Django&#8217;s automatic admin is part of a larger suite of Django functionality
called <tt class="docutils literal"><span class="pre">django.contrib</span></tt> &#8211; the part of the Django codebase that contains
various useful add-ons to the core framework. You can think of
<tt class="docutils literal"><span class="pre">django.contrib</span></tt> as Django&#8217;s equivalent of the Python standard library &#8211;
optional, de facto implementations of common patterns. They&#8217;re bundled with
Django so that you don&#8217;t have to reinvent the wheel in your own applications.</p>
<p>The admin site is the first part of <tt class="docutils literal"><span class="pre">django.contrib</span></tt> that we&#8217;re covering in
this book; technically, it&#8217;s called <tt class="docutils literal"><span class="pre">django.contrib.admin</span></tt>. Other available
features in <tt class="docutils literal"><span class="pre">django.contrib</span></tt> include a user authentication system
(<tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt>), support for anonymous sessions
(<tt class="docutils literal"><span class="pre">django.contrib.sessions</span></tt>) and even a system for user comments
(<tt class="docutils literal"><span class="pre">django.contrib.comments</span></tt>). You&#8217;ll get to know the various <tt class="docutils literal"><span class="pre">django.contrib</span></tt>
features as you become a Django expert, and we&#8217;ll spend some more time
discussing them in Chapter 16. For now, just know that Django ships with many
nice add-ons, and <tt class="docutils literal"><span class="pre">django.contrib</span></tt> is generally where they live.</p>
</div>
<div class="section" id="activating-the-admin-interface">
<h2>Activating the Admin Interface</h2>
<p>The Django admin site is entirely optional, because only certain types of sites
need this functionality. That means you&#8217;ll need to take a few steps to activate
it in your project.</p>
<p>First, make a few changes to your settings file:</p>
<ol class="arabic simple">
<li>Add <tt class="docutils literal"><span class="pre">'django.contrib.admin'</span></tt> to the <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> setting. (The
order of <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> doesn&#8217;t matter, but we like to keep things
alphabetical so it&#8217;s easy for a human to read.)</li>
<li>Make sure <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> contains <tt class="docutils literal"><span class="pre">'django.contrib.auth'</span></tt>,
<tt class="docutils literal"><span class="pre">'django.contrib.contenttypes'</span></tt>, <tt class="docutils literal"><span class="pre">'django.contrib.messages'</span></tt>
and <tt class="docutils literal"><span class="pre">'django.contrib.sessions'</span></tt>. The
Django admin site requires these three packages. (If you&#8217;re following
along with our ongoing <tt class="docutils literal"><span class="pre">mysite</span></tt> project, note that we commented out
these four <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> entries in Chapter 5. Uncomment them now.)</li>
<li>Make sure <tt class="docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt> contains
<tt class="docutils literal"><span class="pre">'django.middleware.common.CommonMiddleware'</span></tt>,
<tt class="docutils literal"><span class="pre">'django.contrib.messages.middleware.MessageMiddleware'</span></tt>,
<tt class="docutils literal"><span class="pre">'django.contrib.sessions.middleware.SessionMiddleware'</span></tt> and
<tt class="docutils literal"><span class="pre">'django.contrib.auth.middleware.AuthenticationMiddleware'</span></tt>. (Again,
if you&#8217;re following along, note that we commented them out in Chapter 5,
so uncomment them.)</li>
</ol>
<p>Second, run <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">syncdb</span></tt>. This step will install the extra
database tables that the admin interface uses. The first time you run
<tt class="docutils literal"><span class="pre">syncdb</span></tt> with <tt class="docutils literal"><span class="pre">'django.contrib.auth'</span></tt> in <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt>, you&#8217;ll be
asked about creating a superuser. If you don&#8217;t do this, you&#8217;ll need to run
<tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">createsuperuser</span></tt> separately to create an admin user
account; otherwise, you won&#8217;t be able to log in to the admin site. (Potential
gotcha: the <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">createsuperuser</span></tt> command is only available if
<tt class="docutils literal"><span class="pre">'django.contrib.auth'</span></tt> is in your <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt>.)</p>
<p>Third, add the admin site to your URLconf (in <tt class="docutils literal"><span class="pre">urls.py</span></tt>, remember). By
default, the <tt class="docutils literal"><span class="pre">urls.py</span></tt> generated by <tt class="docutils literal"><span class="pre">django-admin.py</span> <span class="pre">startproject</span></tt> contains
commented-out code for the Django admin, and all you have to do is uncomment
it. For the record, here are the bits you need to make sure are in there:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Include these import statements...</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="n">admin</span><span class="o">.</span><span class="n">autodiscover</span><span class="p">()</span>

<span class="c"># And include this URLpattern...</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span>
    <span class="c"># ...</span>
    <span class="p">(</span><span class="s">r&#39;^admin/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
    <span class="c"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>With that bit of configuration out of the way, now you can see the Django
admin site in action. Just run the development server
(<tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">runserver</span></tt>, as in previous chapters) and visit
<tt class="docutils literal"><span class="pre">http://127.0.0.1:8000/admin/</span></tt> in your Web browser.</p>
</div>
<div class="section" id="using-the-admin-site">
<h2>Using the Admin Site</h2>
<p>The admin site is designed to be used by nontechnical users, and as such it
should be pretty self-explanatory. Nevertheless, we&#8217;ll give you a quick
walkthrough of the basic features.</p>
<p>The first thing you&#8217;ll see is a login screen, as shown in Figure 6-1.</p>
<div class="figure">
<img alt="Screenshot of Django's login page." src="_images/login.png" />
<p class="caption">Figure 6-1. Django&#8217;s login screen</p>
</div>
<p>Log in with the username and password you set up when you added your superuser.
If you&#8217;re unable to log in, make sure you&#8217;ve actually created a superuser &#8211;
try running <tt class="docutils literal"><span class="pre">python</span> <span class="pre">manage.py</span> <span class="pre">createsuperuser</span></tt>.</p>
<p>Once you&#8217;re logged in, the first thing you&#8217;ll see will be the admin home page.
This page lists all the available types of data that can be edited on the admin
site. At this point, because we haven&#8217;t activated any of our own models yet,
the list is sparse: it includes only Groups and Users, which are the two
default admin-editable models.</p>
<div class="figure">
<img alt="Screenshot of the Django admin home page." src="_images/admin_index.png" />
<p class="caption">Figure 6-2. The Django admin home page</p>
</div>
<p>Each type of data in the Django admin site has a <em>change list</em> and an
<em>edit form</em>. Change lists show you all the available objects in the database,
and edit forms let you add, change or delete particular records in your
database.</p>
<div class="admonition-other-languages admonition">
<p class="first admonition-title">Other languages</p>
<p>If your primary language is not English and your Web browser is configured
to prefer a language other than English, you can make a quick change to
see whether the Django admin site has been translated into your language.
Just add <tt class="docutils literal"><span class="pre">'django.middleware.locale.LocaleMiddleware'</span></tt> to your
<tt class="docutils literal"><span class="pre">MIDDLEWARE_CLASSES</span></tt> setting, making sure it appears <em>after</em>
<tt class="docutils literal"><span class="pre">'django.contrib.sessions.middleware.SessionMiddleware'</span></tt>.</p>
<p>When you&#8217;ve done that, reload the admin index page. If a translation for
your language is available, then the various parts of the interface &#8211; from
the &#8220;Change password&#8221; and &#8220;Log out&#8221; links at the top of the page, to the
&#8220;Groups&#8221; and &#8220;Users&#8221; links in the middle &#8211; will appear in your language
instead of English. Django ships with translations for dozens of languages.</p>
<p class="last">For much more on Django&#8217;s internationalization features, see Chapter 19.</p>
</div>
<p>Click the &#8220;Change&#8221; link in the &#8220;Users&#8221; row to load the change list page for
users.</p>
<div class="figure">
<img alt="Screenshot of the user change list page." src="_images/user_changelist.png" />
<p class="caption">Figure 6-3. The user change list page</p>
</div>
<p>This page displays all users in the database; you can think of it as a
prettied-up Web version of a <tt class="docutils literal"><span class="pre">SELECT</span> <span class="pre">*</span> <span class="pre">FROM</span> <span class="pre">auth_user;</span></tt> SQL query. If you&#8217;re
following along with our ongoing example, you&#8217;ll only see one user here,
assuming you&#8217;ve added only one, but once you have more users, you&#8217;ll probably
find the filtering, sorting and searching options useful. Filtering options are
at right, sorting is available by clicking a column header, and the search box
at the top lets you search by username.</p>
<p>Click the username of the user you created, and you&#8217;ll see the edit form for
that user.</p>
<div class="figure">
<img alt="Screenshot of the user edit form" src="_images/user_editform.png" />
<p class="caption">Figure 6-4. The user edit form</p>
</div>
<p>This page lets you change the attributes of the user, like the
first/last names and various permissions. (Note that to change a user&#8217;s
password, you should click &#8220;change password form&#8221; under the password field
rather than editing the hashed code.) Another thing to note here is that fields
of different types get different widgets &#8211; for example, date/time fields have
calendar controls, boolean fields have checkboxes, character fields have simple
text input fields.</p>
<p>You can delete a record by clicking the delete button at the bottom left of its
edit form. That&#8217;ll take you to a confirmation page, which, in some cases, will
display any dependent objects that will be deleted, too. (For example, if you
delete a publisher, any book with that publisher will be deleted, too!)</p>
<p>You can add a record by clicking &#8220;Add&#8221; in the appropriate column of the admin
home page. This will give you an empty version of the edit page, ready for you
to fill out.</p>
<p>You&#8217;ll also notice that the admin interface also handles input validation for
you. Try leaving a required field blank or putting an invalid date into a date
field, and you&#8217;ll see those errors when you try to save, as shown in Figure 6-5.</p>
<div class="figure">
<img alt="Screenshot of an edit form displaying errors." src="_images/user_editform_errors.png" />
<p class="caption">Figure 6-5. An edit form displaying errors</p>
</div>
<p>When you edit an existing object, you&#8217;ll notice a History link in the
upper-right corner of the window. Every change made through the admin interface
is logged, and you can examine this log by clicking the History link (see
Figure 6-6).</p>
<div class="figure">
<img alt="Screenshot of an object history page." src="_images/user_history.png" />
<p class="caption">Figure 6-6. An object history page</p>
</div>
</div>
<div class="section" id="adding-your-models-to-the-admin-site">
<h2>Adding Your Models to the Admin Site</h2>
<p>There&#8217;s one crucial part we haven&#8217;t done yet. Let&#8217;s add our own models to the
admin site, so we can add, change and delete objects in our custom database
tables using this nice interface. We&#8217;ll continue the <tt class="docutils literal"><span class="pre">books</span></tt> example from
Chapter 5, where we defined three models: <tt class="docutils literal"><span class="pre">Publisher</span></tt>, <tt class="docutils literal"><span class="pre">Author</span></tt> and
<tt class="docutils literal"><span class="pre">Book</span></tt>.</p>
<p>Within the <tt class="docutils literal"><span class="pre">books</span></tt> directory (<tt class="docutils literal"><span class="pre">mysite/books</span></tt>), create a file called
<tt class="docutils literal"><span class="pre">admin.py</span></tt>, and type in the following lines of code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">mysite.books.models</span> <span class="kn">import</span> <span class="n">Publisher</span><span class="p">,</span> <span class="n">Author</span><span class="p">,</span> <span class="n">Book</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Publisher</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">Book</span><span class="p">)</span>
</pre></div>
</div>
<p>This code tells the Django admin site to offer an interface for each of these
models.</p>
<p>Once you&#8217;ve done this, go to your admin home page in your Web browser
(<tt class="docutils literal"><span class="pre">http://127.0.0.1:8000/admin/</span></tt>), and you should see a &#8220;Books&#8221; section with
links for Authors, Books and Publishers. (You might have to stop and start the
<tt class="docutils literal"><span class="pre">runserver</span></tt> for the changes to take effect.)</p>
<p>You now have a fully functional admin interface for each of those three models.
That was easy!</p>
<p>Take some time to add and change records, to populate your database with some
data. If you followed Chapter 5&#8217;s examples of creating <tt class="docutils literal"><span class="pre">Publisher</span></tt> objects
(and you didn&#8217;t delete them), you&#8217;ll already see those records on the publisher
change list page.</p>
<p>One feature worth mentioning here is the admin site&#8217;s handling of foreign keys
and many-to-many relationships, both of which appear in the <tt class="docutils literal"><span class="pre">Book</span></tt> model. As
a reminder, here&#8217;s what the <tt class="docutils literal"><span class="pre">Book</span></tt> model looks like:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>
    <span class="n">publisher</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Publisher</span><span class="p">)</span>
    <span class="n">publication_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</pre></div>
</div>
<p>On the Django admin site&#8217;s &#8220;Add book&#8221; page
(<tt class="docutils literal"><span class="pre">http://127.0.0.1:8000/admin/books/book/add/</span></tt>), the publisher (a
<tt class="docutils literal"><span class="pre">ForeignKey</span></tt>) is represented by a select box, and the authors field
(a <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt>) is represented by a multiple-select box. Both fields
sit next to a green plus sign icon that lets you add related records of that
type. For example, if you click the green plus sign next to the &#8220;Publisher&#8221;
field, you&#8217;ll get a pop-up window that lets you add a publisher. After you
successfully create the publisher in the pop-up, the &#8220;Add book&#8221; form will be
updated with the newly created publisher. Slick.</p>
</div>
<div class="section" id="how-the-admin-site-works">
<h2>How the Admin Site Works</h2>
<p>Behind the scenes, how does the admin site work? It&#8217;s pretty straightforward.</p>
<p>When Django loads your URLconf from <tt class="docutils literal"><span class="pre">urls.py</span></tt> at server startup, it executes
the <tt class="docutils literal"><span class="pre">admin.autodiscover()</span></tt> statement that we added as part of activating the
admin. This function iterates over your <tt class="docutils literal"><span class="pre">INSTALLED_APPS</span></tt> setting and looks
for a file called <tt class="docutils literal"><span class="pre">admin.py</span></tt> in each installed app. If an <tt class="docutils literal"><span class="pre">admin.py</span></tt>
exists in a given app, it executes the code in that file.</p>
<p>In the <tt class="docutils literal"><span class="pre">admin.py</span></tt> in our <tt class="docutils literal"><span class="pre">books</span></tt> app, each call to
<tt class="docutils literal"><span class="pre">admin.site.register()</span></tt> simply registers the given model with the admin. The
admin site will only display an edit/change interface for models that have been
explicitly registered.</p>
<p>The app <tt class="docutils literal"><span class="pre">django.contrib.auth</span></tt> includes its own <tt class="docutils literal"><span class="pre">admin.py</span></tt>, which is why
Users and Groups showed up automatically in the admin. Other <tt class="docutils literal"><span class="pre">django.contrib</span></tt>
apps, such as <tt class="docutils literal"><span class="pre">django.contrib.redirects</span></tt>, also add themselves to the admin,
as do many third-party Django applications you might download from the Web.</p>
<p>Beyond that, the Django admin site is just a Django application, with its own
models, templates, views and URLpatterns. You add it to your application by
hooking it into your URLconf, just as you hook in your own views. You can
inspect its templates, views and URLpatterns by poking around in
<tt class="docutils literal"><span class="pre">django/contrib/admin</span></tt> in your copy of the Django codebase &#8211; but don&#8217;t be
tempted to change anything directly in there, as there are plenty of hooks for
you to customize the way the admin site works. (If you do decide to poke around
the Django admin application, keep in mind it does some rather complicated
things in reading metadata about models, so it would probably take a good
amount of time to read and understand the code.)</p>
</div>
<div class="section" id="making-fields-optional">
<h2>Making Fields Optional</h2>
<p>After you play around with the admin site for a while, you&#8217;ll probably notice a
limitation &#8211; the edit forms require every field to be filled out, whereas in
many cases you&#8217;d want certain fields to be optional. Let&#8217;s say, for example,
that we want our <tt class="docutils literal"><span class="pre">Author</span></tt> model&#8217;s <tt class="docutils literal"><span class="pre">email</span></tt> field to be optional &#8211; that is,
a blank string should be allowed. In the real world, you might not have an
e-mail address on file for every author.</p>
<p>To specify that the <tt class="docutils literal"><span class="pre">email</span></tt> field is optional, edit the <tt class="docutils literal"><span class="pre">Author</span></tt> model
(which, as you&#8217;ll recall from Chapter 5, lives in <tt class="docutils literal"><span class="pre">mysite/books/models.py</span></tt>).
Simply add <tt class="docutils literal"><span class="pre">blank=True</span></tt> to the <tt class="docutils literal"><span class="pre">email</span></tt> field, like so:</p>
<pre class="literal-block">
class Author(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(<strong>blank=True</strong>)
</pre>
<p>This tells Django that a blank value is indeed allowed for authors&#8217; e-mail
addresses. By default, all fields have <tt class="docutils literal"><span class="pre">blank=False</span></tt>, which means blank
values are not allowed.</p>
<p>There&#8217;s something interesting happening here. Until now, with the exception of
the <tt class="docutils literal"><span class="pre">__unicode__()</span></tt> method, our models have served as definitions of our
database tables &#8211; Pythonic expressions of SQL <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt> statements,
essentially. In adding <tt class="docutils literal"><span class="pre">blank=True</span></tt>, we have begun expanding our model beyond
a simple definition of what the database table looks like. Now, our model class
is starting to become a richer collection of knowledge about what <tt class="docutils literal"><span class="pre">Author</span></tt>
objects are and what they can do. Not only is the <tt class="docutils literal"><span class="pre">email</span></tt> field represented
by a <tt class="docutils literal"><span class="pre">VARCHAR</span></tt> column in the database; it&#8217;s also an optional field in
contexts such as the Django admin site.</p>
<p>Once you&#8217;ve added that <tt class="docutils literal"><span class="pre">blank=True</span></tt>, reload the &#8220;Add author&#8221; edit form
(<tt class="docutils literal"><span class="pre">http://127.0.0.1:8000/admin/books/author/add/</span></tt>), and you&#8217;ll notice the
field&#8217;s label &#8211; &#8220;Email&#8221; &#8211; is no longer bolded. This signifies it&#8217;s not a
required field. You can now add authors without needing to provide
e-mail addresses; you won&#8217;t get the loud red &#8220;This field is required&#8221; message
anymore, if the field is submitted empty.</p>
<div class="section" id="making-date-and-numeric-fields-optional">
<h3>Making Date and Numeric Fields Optional</h3>
<p>A common gotcha related to <tt class="docutils literal"><span class="pre">blank=True</span></tt> has to do with date and numeric
fields, but it requires a fair amount of background explanation.</p>
<p>SQL has its own way of specifying blank values &#8211; a special value called
<tt class="docutils literal"><span class="pre">NULL</span></tt>. <tt class="docutils literal"><span class="pre">NULL</span></tt> could mean &#8220;unknown,&#8221; or &#8220;invalid,&#8221; or some other
application-specific meaning.</p>
<p>In SQL, a value of <tt class="docutils literal"><span class="pre">NULL</span></tt> is different than an empty string, just as the
special Python object <tt class="docutils literal"><span class="pre">None</span></tt> is different than an empty Python string
(<tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt>). This means it&#8217;s possible for a particular character field (e.g., a
<tt class="docutils literal"><span class="pre">VARCHAR</span></tt> column) to contain both <tt class="docutils literal"><span class="pre">NULL</span></tt> values and empty string values.</p>
<p>This can cause unwanted ambiguity and confusion: &#8220;Why does this record have a
<tt class="docutils literal"><span class="pre">NULL</span></tt> but this other one has an empty string? Is there a difference, or was
the data just entered inconsistently?&#8221; And: &#8220;How do I get all the records that
have a blank value &#8211; should I look for both <tt class="docutils literal"><span class="pre">NULL</span></tt> records and empty
strings, or do I only select the ones with empty strings?&#8221;</p>
<p>To help avoid such ambiguity, Django&#8217;s automatically generated <tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt>
statements (which were covered in Chapter 5) add an explicit <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt> to
each column definition. For example, here&#8217;s the generated statement for our
<tt class="docutils literal"><span class="pre">Author</span></tt> model, from Chapter 5:</p>
<div class="highlight-python"><pre>CREATE TABLE "books_author" (
    "id" serial NOT NULL PRIMARY KEY,
    "first_name" varchar(30) NOT NULL,
    "last_name" varchar(40) NOT NULL,
    "email" varchar(75) NOT NULL
)
;</pre>
</div>
<p>In most cases, this default behavior is optimal for your application and will
save you from data-inconsistency headaches. And it works nicely with the rest
of Django, such as the Django admin site, which inserts an empty string (<em>not</em>
a <tt class="docutils literal"><span class="pre">NULL</span></tt> value) when you leave a character field blank.</p>
<p>But there&#8217;s an exception with database column types that do not accept empty
strings as valid values &#8211; such as dates, times and numbers. If you try to
insert an empty string into a date or integer column, you&#8217;ll likely get a
database error, depending on which database you&#8217;re using. (PostgreSQL, which is
strict, will raise an exception here; MySQL might accept it or might not,
depending on the version you&#8217;re using, the time of day and the phase of the
moon.) In this case, <tt class="docutils literal"><span class="pre">NULL</span></tt> is the only way to specify an empty
value. In Django models, you can specify that <tt class="docutils literal"><span class="pre">NULL</span></tt> is allowed by adding
<tt class="docutils literal"><span class="pre">null=True</span></tt> to a field.</p>
<p>So that&#8217;s a long way of saying this: if you want to allow blank values in a
date field (e.g., <tt class="docutils literal"><span class="pre">DateField</span></tt>, <tt class="docutils literal"><span class="pre">TimeField</span></tt>, <tt class="docutils literal"><span class="pre">DateTimeField</span></tt>) or numeric
field (e.g., <tt class="docutils literal"><span class="pre">IntegerField</span></tt>, <tt class="docutils literal"><span class="pre">DecimalField</span></tt>, <tt class="docutils literal"><span class="pre">FloatField</span></tt>), you&#8217;ll need
to use both <tt class="docutils literal"><span class="pre">null=True</span></tt> <em>and</em> <tt class="docutils literal"><span class="pre">blank=True</span></tt>.</p>
<p>For sake of example, let&#8217;s change our <tt class="docutils literal"><span class="pre">Book</span></tt> model to allow a blank
<tt class="docutils literal"><span class="pre">publication_date</span></tt>. Here&#8217;s the revised code:</p>
<pre class="literal-block">
class Book(models.Model):
    title = models.CharField(max_length=100)
    authors = models.ManyToManyField(Author)
    publisher = models.ForeignKey(Publisher)
    publication_date = models.DateField(<strong>blank=True, null=True</strong>)
</pre>
<p>Adding <tt class="docutils literal"><span class="pre">null=True</span></tt> is more complicated than adding <tt class="docutils literal"><span class="pre">blank=True</span></tt>, because
<tt class="docutils literal"><span class="pre">null=True</span></tt> changes the semantics of the database &#8211; that is, it changes the
<tt class="docutils literal"><span class="pre">CREATE</span> <span class="pre">TABLE</span></tt> statement to remove the <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt> from the
<tt class="docutils literal"><span class="pre">publication_date</span></tt> field. To complete this change, we&#8217;ll need to update the
database.</p>
<p>For a number of reasons, Django does not attempt to automate changes to
database schemas, so it&#8217;s your own responsibility to execute the appropriate
<tt class="docutils literal"><span class="pre">ALTER</span> <span class="pre">TABLE</span></tt> statement whenever you make such a change to a model. Recall
that you can use <tt class="docutils literal"><span class="pre">manage.py</span> <span class="pre">dbshell</span></tt> to enter your database server&#8217;s shell.
Here&#8217;s how to remove the <tt class="docutils literal"><span class="pre">NOT</span> <span class="pre">NULL</span></tt> in this particular case:</p>
<div class="highlight-python"><pre>ALTER TABLE books_book ALTER COLUMN publication_date DROP NOT NULL;</pre>
</div>
<p>(Note that this SQL syntax is specific to PostgreSQL.)</p>
<p>We&#8217;ll cover schema changes in more depth in Chapter 10.</p>
<p>Bringing this back to the admin site, now the &#8220;Add book&#8221; edit form should allow
for empty publication date values.</p>
</div>
</div>
<div class="section" id="customizing-field-labels">
<h2>Customizing Field Labels</h2>
<p>On the admin site&#8217;s edit forms, each field&#8217;s label is generated from its model
field name. The algorithm is simple: Django just replaces underscores with
spaces and capitalizes the first character, so, for example, the <tt class="docutils literal"><span class="pre">Book</span></tt>
model&#8217;s <tt class="docutils literal"><span class="pre">publication_date</span></tt> field has the label &#8220;Publication date.&#8221;</p>
<p>However, field names don&#8217;t always lend themselves to nice admin field labels,
so in some cases you might want to customize a label. You can do this by
specifying <tt class="docutils literal"><span class="pre">verbose_name</span></tt> in the appropriate model field.</p>
<p>For example, here&#8217;s how we can change the label of the <tt class="docutils literal"><span class="pre">Author.email</span></tt> field
to &#8220;e-mail,&#8221; with a hyphen:</p>
<pre class="literal-block">
class Author(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(blank=True, <strong>verbose_name='e-mail'</strong>)
</pre>
<p>Make that change and reload the server, and you should see the field&#8217;s new
label on the author edit form.</p>
<p>Note that you shouldn&#8217;t capitalize the first letter of a <tt class="docutils literal"><span class="pre">verbose_name</span></tt>
unless it should <em>always</em> be capitalized (e.g., <tt class="docutils literal"><span class="pre">&quot;USA</span> <span class="pre">state&quot;</span></tt>). Django will
automatically capitalize it when it needs to, and it will use the exact
<tt class="docutils literal"><span class="pre">verbose_name</span></tt> value in other places that don&#8217;t require capitalization.</p>
<p>Finally, note that you can pass the <tt class="docutils literal"><span class="pre">verbose_name</span></tt> as a positional argument,
for a slightly more compact syntax. This example is equivalent to the previous
one:</p>
<pre class="literal-block">
class Author(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(<strong>'e-mail',</strong> blank=True)
</pre>
<p>This won&#8217;t work with <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt> or <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> fields, though,
because they require the first argument to be a model class. In those cases,
specifying <tt class="docutils literal"><span class="pre">verbose_name</span></tt> explicitly is the way to go.</p>
</div>
<div class="section" id="custom-modeladmin-classes">
<h2>Custom ModelAdmin classes</h2>
<p>The changes we&#8217;ve made so far &#8211; <tt class="docutils literal"><span class="pre">blank=True</span></tt>, <tt class="docutils literal"><span class="pre">null=True</span></tt> and
<tt class="docutils literal"><span class="pre">verbose_name</span></tt> &#8211; are really model-level changes, not admin-level changes.
That is, these changes are fundamentally a part of the model and just so happen
to be used by the admin site; there&#8217;s nothing admin-specific about them.</p>
<p>Beyond these, the Django admin site offers a wealth of options that let you
customize how the admin site works for a particular model. Such options live in
<em>ModelAdmin classes</em>, which are classes that contain configuration for a
specific model in a specific admin site instance.</p>
<div class="section" id="customizing-change-lists">
<h3>Customizing change lists</h3>
<p>Let&#8217;s dive into admin customization by specifying the fields that are
displayed on the change list for our <tt class="docutils literal"><span class="pre">Author</span></tt> model. By default, the change
list displays the result of <tt class="docutils literal"><span class="pre">__unicode__()</span></tt> for each object. In Chapter 5, we
defined the <tt class="docutils literal"><span class="pre">__unicode__()</span></tt> method for <tt class="docutils literal"><span class="pre">Author</span></tt> objects to display the
first name and last name together:</p>
<pre class="literal-block">
class Author(models.Model):
    first_name = models.CharField(max_length=30)
    last_name = models.CharField(max_length=40)
    email = models.EmailField(blank=True, verbose_name='e-mail')

    <strong>def __unicode__(self):</strong>
        <strong>return u'%s %s' % (self.first_name, self.last_name)</strong>
</pre>
<p>As a result, the change list for <tt class="docutils literal"><span class="pre">Author</span></tt> objects displays each other&#8217;s
first name and last name together, as you can see in Figure 6-7.</p>
<div class="figure">
<img alt="Screenshot of the author change list page." src="_images/author_changelist1.png" />
<p class="caption">Figure 6-7. The author change list page</p>
</div>
<p>We can improve on this default behavior by adding a few other fields to the
change list display. It&#8217;d be handy, for example, to see each author&#8217;s e-mail
address in this list, and it&#8217;d be nice to be able to sort by first and last
name.</p>
<p>To make this happen, we&#8217;ll define a <tt class="docutils literal"><span class="pre">ModelAdmin</span></tt> class for the <tt class="docutils literal"><span class="pre">Author</span></tt>
model. This class is the key to customizing the admin, and one of the most
basic things it lets you do is specify the list of fields to display on change
list pages. Edit <tt class="docutils literal"><span class="pre">admin.py</span></tt> to make these changes:</p>
<pre class="literal-block">
from django.contrib import admin
from mysite.books.models import Publisher, Author, Book

<strong>class AuthorAdmin(admin.ModelAdmin):</strong>
    <strong>list_display = ('first_name', 'last_name', 'email')</strong>

admin.site.register(Publisher)
<strong>admin.site.register(Author, AuthorAdmin)</strong>
admin.site.register(Book)
</pre>
<p>Here&#8217;s what we&#8217;ve done:</p>
<ul>
<li><p class="first">We created the class <tt class="docutils literal"><span class="pre">AuthorAdmin</span></tt>. This class, which subclasses
<tt class="docutils literal"><span class="pre">django.contrib.admin.ModelAdmin</span></tt>, holds custom configuration
for a specific admin model. We&#8217;ve only specified one customization &#8211;
<tt class="docutils literal"><span class="pre">list_display</span></tt>, which is set to a tuple of field names to display on
the change list page. These field names must exist in the model, of
course.</p>
</li>
<li><p class="first">We altered the <tt class="docutils literal"><span class="pre">admin.site.register()</span></tt> call to add <tt class="docutils literal"><span class="pre">AuthorAdmin</span></tt> after
<tt class="docutils literal"><span class="pre">Author</span></tt>. You can read this as: &#8220;Register the <tt class="docutils literal"><span class="pre">Author</span></tt> model with the
<tt class="docutils literal"><span class="pre">AuthorAdmin</span></tt> options.&#8221;</p>
<p>The <tt class="docutils literal"><span class="pre">admin.site.register()</span></tt> function takes a <tt class="docutils literal"><span class="pre">ModelAdmin</span></tt> subclass as
an optional second argument. If you don&#8217;t specify a second argument (as
is the case for <tt class="docutils literal"><span class="pre">Publisher</span></tt> and <tt class="docutils literal"><span class="pre">Book</span></tt>), Django will use the default
admin options for that model.</p>
</li>
</ul>
<p>With that tweak made, reload the author change list page, and you&#8217;ll see it&#8217;s
now displaying three columns &#8211; the first name, last name and e-mail address.
In addition, each of those columns is sortable by clicking on the column
header. (See Figure 6-8.)</p>
<div class="figure">
<img alt="Screenshot of the author change list page after list_display." src="_images/author_changelist2.png" />
<p class="caption">Figure 6-8. The author change list page after list_display</p>
</div>
<p>Next, let&#8217;s add a simple search bar. Add <tt class="docutils literal"><span class="pre">search_fields</span></tt> to the
<tt class="docutils literal"><span class="pre">AuthorAdmin</span></tt>, like so:</p>
<pre class="literal-block">
class AuthorAdmin(admin.ModelAdmin):
    list_display = ('first_name', 'last_name', 'email')
    <strong>search_fields = ('first_name', 'last_name')</strong>
</pre>
<p>Reload the page in your browser, and you should see a search bar at the top.
(See Figure 6-9.) We&#8217;ve just told the admin change list page to include a
search bar that searches against the <tt class="docutils literal"><span class="pre">first_name</span></tt> and <tt class="docutils literal"><span class="pre">last_name</span></tt> fields.
As a user might expect, this is case-insensitive and searches both fields, so
searching for the string <tt class="docutils literal"><span class="pre">&quot;bar&quot;</span></tt> would find both an author with the first
name Barney and an author with the last name Hobarson.</p>
<div class="figure">
<img alt="Screenshot of the author change list page after search_fields." src="_images/author_changelist3.png" />
<p class="caption">Figure 6-9. The author change list page after search_fields</p>
</div>
<p>Next, let&#8217;s add some date filters to our <tt class="docutils literal"><span class="pre">Book</span></tt> model&#8217;s change list page:</p>
<pre class="literal-block">
from django.contrib import admin
from mysite.books.models import Publisher, Author, Book

class AuthorAdmin(admin.ModelAdmin):
    list_display = ('first_name', 'last_name', 'email')
    search_fields = ('first_name', 'last_name')

<strong>class BookAdmin(admin.ModelAdmin):</strong>
    <strong>list_display = ('title', 'publisher', 'publication_date')</strong>
    <strong>list_filter = ('publication_date',)</strong>

admin.site.register(Publisher)
admin.site.register(Author, AuthorAdmin)
<strong>admin.site.register(Book, BookAdmin)</strong>
</pre>
<p>Here, because we&#8217;re dealing with a different set of options, we created a
separate <tt class="docutils literal"><span class="pre">ModelAdmin</span></tt> class &#8211; <tt class="docutils literal"><span class="pre">BookAdmin</span></tt>. First, we defined a
<tt class="docutils literal"><span class="pre">list_display</span></tt> just to make the change list look a bit nicer. Then, we
used <tt class="docutils literal"><span class="pre">list_filter</span></tt>, which is set to a tuple of fields to use to create
filters along the right side of the change list page. For date fields, Django
provides shortcuts to filter the list to &#8220;Today,&#8221; &#8220;Past 7 days,&#8221; &#8220;This month&#8221;
and &#8220;This year&#8221; &#8211; shortcuts that Django&#8217;s developers have found hit the
common cases for filtering by date. Figure 6-10 shows what that looks like.</p>
<div class="figure">
<img alt="Screenshot of the book change list page after list_filter." src="_images/book_changelist1.png" />
<p class="caption">Figure 6-10. The book change list page after list_filter</p>
</div>
<p><tt class="docutils literal"><span class="pre">list_filter</span></tt> also works on fields of other types, not just <tt class="docutils literal"><span class="pre">DateField</span></tt>.
(Try it with <tt class="docutils literal"><span class="pre">BooleanField</span></tt> and <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> fields, for example.) The
filters show up as long as there are at least 2 values to choose from.</p>
<p>Another way to offer date filters is to use the <tt class="docutils literal"><span class="pre">date_hierarchy</span></tt> admin
option, like this:</p>
<pre class="literal-block">
class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'publisher', 'publication_date')
    list_filter = ('publication_date',)
    <strong>date_hierarchy = 'publication_date'</strong>
</pre>
<p>With this in place, the change list page gets a date drill-down navigation bar
at the top of the list, as shown in Figure 6-11. It starts with a list of
available years, then drills down into months and individual days.</p>
<div class="figure">
<img alt="Screenshot of the book change list page after date_hierarchy." src="_images/book_changelist2.png" />
<p class="caption">Figure 6-11. The book change list page after date_hierarchy</p>
</div>
<p>Note that <tt class="docutils literal"><span class="pre">date_hierarchy</span></tt> takes a <em>string</em>, not a tuple, because only one
date field can be used to make the hierarchy.</p>
<p>Finally, let&#8217;s change the default ordering so that books on the change list
page are always ordered descending by their publication date. By default,
the change list orders objects according to their model&#8217;s <tt class="docutils literal"><span class="pre">ordering</span></tt> within
<tt class="docutils literal"><span class="pre">class</span> <span class="pre">Meta</span></tt> (which we covered in Chapter 5) &#8211; but you haven&#8217;t specified
this <tt class="docutils literal"><span class="pre">ordering</span></tt> value, then the ordering is undefined.</p>
<pre class="literal-block">
class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'publisher', 'publication_date')
    list_filter = ('publication_date',)
    date_hierarchy = 'publication_date'
    <strong>ordering = ('-publication_date',)</strong>
</pre>
<p>This admin <tt class="docutils literal"><span class="pre">ordering</span></tt> option works exactly as the <tt class="docutils literal"><span class="pre">ordering</span></tt> in models&#8217;
<tt class="docutils literal"><span class="pre">class</span> <span class="pre">Meta</span></tt>, except that it only uses the first field name in the list. Just
pass a list or tuple of field names, and add a minus sign to a field to use
descending sort order.</p>
<p>Reload the book change list to see this in action. Note that the
&#8220;Publication date&#8221; header now includes a small arrow that indicates which way
the records are sorted. (See Figure 6-12.)</p>
<div class="figure">
<img alt="Screenshot of the book change list page after ordering." src="_images/book_changelist3.png" />
<p class="caption">Figure 6-12. The book change list page after ordering</p>
</div>
<p>We&#8217;ve covered the main change list options here. Using these options, you can
make a very powerful, production-ready data-editing interface with only a few
lines of code.</p>
</div>
<div class="section" id="customizing-edit-forms">
<h3>Customizing edit forms</h3>
<p>Just as the change list can be customized, edit forms can be customized in many
ways.</p>
<p>First, let&#8217;s customize the way fields are ordered. By default, the order of
fields in an edit form corresponds to the order they&#8217;re defined in the model.
We can change that using the <tt class="docutils literal"><span class="pre">fields</span></tt> option in our <tt class="docutils literal"><span class="pre">ModelAdmin</span></tt> subclass:</p>
<pre class="literal-block">
class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'publisher', 'publication_date')
    list_filter = ('publication_date',)
    date_hierarchy = 'publication_date'
    ordering = ('-publication_date',)
    <strong>fields = ('title', 'authors', 'publisher', 'publication_date')</strong>
</pre>
<p>After this change, the edit form for books will use the given ordering for
fields. It&#8217;s slightly more natural to have the authors after the book title.
Of course, the field order should depend on your data-entry workflow. Every
form is different.</p>
<p>Another useful thing the <tt class="docutils literal"><span class="pre">fields</span></tt> option lets you do is to <em>exclude</em> certain
fields from being edited entirely. Just leave out the field(s) you want to
exclude. You might use this if your admin users are only trusted to edit a
certain segment of your data, or if part of your fields are changed by some
outside, automated process. For example, in our book database, we could
hide the <tt class="docutils literal"><span class="pre">publication_date</span></tt> field from being editable:</p>
<pre class="literal-block">
class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'publisher', 'publication_date')
    list_filter = ('publication_date',)
    date_hierarchy = 'publication_date'
    ordering = ('-publication_date',)
    <strong>fields = ('title', 'authors', 'publisher')</strong>
</pre>
<p>As a result, the edit form for books doesn&#8217;t offer a way to specify the
publication date. This could be useful, say, if you&#8217;re an editor who prefers
that his authors not push back publication dates. (This is purely a
hypothetical example, of course.)</p>
<p>When a user uses this incomplete form to add a new book, Django will simply set
the <tt class="docutils literal"><span class="pre">publication_date</span></tt> to <tt class="docutils literal"><span class="pre">None</span></tt> &#8211; so make sure that field has
<tt class="docutils literal"><span class="pre">null=True</span></tt>.</p>
<p>Another commonly used edit-form customization has to do with many-to-many
fields. As we&#8217;ve seen on the edit form for books, the admin site represents each
<tt class="docutils literal"><span class="pre">ManyToManyField</span></tt> as a multiple-select boxes, which is the most logical
HTML input widget to use &#8211; but multiple-select boxes can be difficult to use.
If you want to select multiple items, you have to hold down the control key,
or command on a Mac, to do so. The admin site helpfully inserts a bit of text
that explains this, but, still, it gets unwieldy when your field contains
hundreds of options.</p>
<p>The admin site&#8217;s solution is <tt class="docutils literal"><span class="pre">filter_horizontal</span></tt>. Let&#8217;s add that to
<tt class="docutils literal"><span class="pre">BookAdmin</span></tt> and see what it does.</p>
<pre class="literal-block">
class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'publisher', 'publication_date')
    list_filter = ('publication_date',)
    date_hierarchy = 'publication_date'
    ordering = ('-publication_date',)
    <strong>filter_horizontal = ('authors',)</strong>
</pre>
<p>(If you&#8217;re following along, note that we&#8217;ve also removed the <tt class="docutils literal"><span class="pre">fields</span></tt> option
to restore all the fields in the edit form.)</p>
<p>Reload the edit form for books, and you&#8217;ll see that the &#8220;Authors&#8221; section now
uses a fancy JavaScript filter interface that lets you search through the
options dynamically and move specific authors from &#8220;Available authors&#8221; to
the &#8220;Chosen authors&#8221; box, and vice versa.</p>
<div class="figure">
<img alt="Screenshot of the book edit form after adding filter_horizontal." src="_images/book_editform1.png" />
<p class="caption">Figure 6-13. The book edit form after adding filter_horizontal</p>
</div>
<p>We&#8217;d highly recommend using <tt class="docutils literal"><span class="pre">filter_horizontal</span></tt> for any <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt>
that has more than 10 items. It&#8217;s far easier to use than a simple
multiple-select widget. Also, note you can use <tt class="docutils literal"><span class="pre">filter_horizontal</span></tt>
for multiple fields &#8211; just specify each name in the tuple.</p>
<p><tt class="docutils literal"><span class="pre">ModelAdmin</span></tt> classes also support a <tt class="docutils literal"><span class="pre">filter_vertical</span></tt> option. This works
exactly as <tt class="docutils literal"><span class="pre">filter_horizontal</span></tt>, but the resulting JavaScript interface stacks
the two boxes vertically instead of horizontally. It&#8217;s a matter of personal
taste.</p>
<p><tt class="docutils literal"><span class="pre">filter_horizontal</span></tt> and <tt class="docutils literal"><span class="pre">filter_vertical</span></tt> only work on <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt>
fields, not <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> fields. By default, the admin site uses simple
<tt class="docutils literal"><span class="pre">&lt;select&gt;</span></tt> boxes for <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> fields, but, as for <tt class="docutils literal"><span class="pre">ManyToManyField</span></tt>,
sometimes you don&#8217;t want to incur the overhead of having to select all the
related objects to display in the drop-down. For example, if our book database
grows to include thousands of publishers, the &#8220;Add book&#8221; form could take a
while to load, because it would have to load every publisher for display in the
<tt class="docutils literal"><span class="pre">&lt;select&gt;</span></tt> box.</p>
<p>The way to fix this is to use an option called <tt class="docutils literal"><span class="pre">raw_id_fields</span></tt>. Set this to
a tuple of <tt class="docutils literal"><span class="pre">ForeignKey</span></tt> field names, and those fields will be displayed in
the admin with a simple text input box (<tt class="docutils literal"><span class="pre">&lt;input</span> <span class="pre">type=&quot;text&quot;&gt;</span></tt>) instead of a
<tt class="docutils literal"><span class="pre">&lt;select&gt;</span></tt>. See Figure 6-14.</p>
<pre class="literal-block">
class BookAdmin(admin.ModelAdmin):
    list_display = ('title', 'publisher', 'publication_date')
    list_filter = ('publication_date',)
    date_hierarchy = 'publication_date'
    ordering = ('-publication_date',)
    filter_horizontal = ('authors',)
    <strong>raw_id_fields = ('publisher',)</strong>
</pre>
<div class="figure">
<img alt="Screenshot of edit form after raw_id_fields." src="_images/book_editform2.png" />
<p class="caption">Figure 6-14. The book edit form after adding raw_id_fields</p>
</div>
<p>What do you enter in this input box? The database ID of the publisher. Given
that humans don&#8217;t normally memorize database IDs, there&#8217;s also a
magnifying-glass icon that you can click to pull up a pop-up window, from which
you can select the publisher to add.</p>
</div>
</div>
<div class="section" id="users-groups-and-permissions">
<h2>Users, Groups, and Permissions</h2>
<p>Because you&#8217;re logged in as a superuser, you have access to create, edit, and
delete any object. Naturally, different environments require different
permission systems &#8211; not everybody can or should be a superuser. Django&#8217;s
admin site uses a permissions system that you can use to give specific users
access only to the portions of the interface that they need.</p>
<p>These user accounts are meant to be generic enough to be used outside of the
admin interface, but we&#8217;ll just treat them as admin user accounts for now. In
Chapter 14, we&#8217;ll cover how to integrate user accounts with the rest of your
site (i.e., not just the admin site).</p>
<p>You can edit users and permissions through the admin interface just like any
other object. We saw this earlier in this chapter, when we played around with
the User and Group sections of the admin. User objects have the standard
username, password, e-mail and real name fields you might expect, along with a
set of fields that define what the user is allowed to do in the admin
interface. First, there&#8217;s a set of three boolean flags:</p>
<ul class="simple">
<li>The &#8220;active&#8221; flag controls whether the user is active at all.
If this flag is off and the user tries to log in, he won&#8217;t be allowed in,
even with a valid password.</li>
<li>The &#8220;staff&#8221; flag controls whether the user is allowed to log in to the
admin interface (i.e., whether that user is considered a &#8220;staff member&#8221; in
your organization). Since this same user system can be used to control
access to public (i.e., non-admin) sites (see Chapter 14), this flag
differentiates between public users and administrators.</li>
<li>The &#8220;superuser&#8221; flag gives the user full access to add, create and
delete any item in the admin interface. If a user has this flag set, then
all regular permissions (or lack thereof) are ignored for that user.</li>
</ul>
<p>&#8220;Normal&#8221; admin users &#8211; that is, active, non-superuser staff members &#8211; are
granted admin access through assigned permissions. Each object editable through
the admin interface (e.g., books, authors, publishers) has three permissions: a
<em>create</em> permission, an <em>edit</em> permission and a <em>delete</em> permission. Assigning
permissions to a user grants the user access to do what is described by those
permissions.</p>
<p>When you create a user, that user has no permissions, and it&#8217;s up to you to
give the user specific permissions. For example, you can give a user permission
to add and change publishers, but not permission to delete them. Note that
these permissions are defined per-model, not per-object &#8211; so they let you say
&#8220;John can make changes to any book,&#8221; but they don&#8217;t let you say &#8220;John can make
changes to any book published by Apress.&#8221; The latter functionality, per-object
permissions, is a bit more complicated and is outside the scope of this book
but is covered in the Django documentation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Access to edit users and permissions is also controlled by this permission
system. If you give someone permission to edit users, she will be able to
edit her own permissions, which might not be what you want! Giving a user
permission to edit users is essentially turning a user into a superuser.</p>
</div>
<p>You can also assign users to groups. A <em>group</em> is simply a set of permissions to
apply to all members of that group. Groups are useful for granting identical
permissions to a subset of users.</p>
</div>
<div class="section" id="when-and-why-to-use-the-admin-interface-and-when-not-to">
<h2>When and Why to Use the Admin Interface &#8211; And When Not to</h2>
<p>After having worked through this chapter, you should have a good idea of how to
use Django&#8217;s admin site. But we want to make a point of covering <em>when</em> and
<em>why</em> you might want to use it &#8211; and when <em>not</em> to use it.</p>
<p>Django&#8217;s admin site especially shines when nontechnical users need to be able
to enter data; that&#8217;s the purpose behind the feature, after all. At the
newspaper where Django was first developed, development of a typical online
feature &#8211; say, a special report on water quality in the municipal supply &#8211;
would go something like this:</p>
<ul class="simple">
<li>The reporter responsible for the project meets with one of the developers
and describes the available data.</li>
<li>The developer designs Django models to fit this data and then opens up
the admin site to the reporter.</li>
<li>The reporter inspects the admin site to point out any missing or
extraneous fields &#8211; better now than later. The developer changes the
models iteratively.</li>
<li>When the models are agreed upon, the reporter begins entering data using
the admin site. At the same time, the programmer can focus on developing
the publicly accessible views/templates (the fun part!).</li>
</ul>
<p>In other words, the raison d&#8217;être of Django&#8217;s admin interface is facilitating
the simultaneous work of content producers and programmers.</p>
<p>However, beyond these obvious data entry tasks, the admin site is useful in a
few other cases:</p>
<ul class="simple">
<li><em>Inspecting data models</em>: Once you&#8217;ve defined a few models, it can be
quite useful to call them up in the admin interface and enter some dummy
data. In some cases, this might reveal data-modeling mistakes or other
problems with your models.</li>
<li><em>Managing acquired data</em>: For applications that rely on data coming from
external sources (e.g., users or Web crawlers), the admin site gives you
an easy way to inspect or edit this data. You can think of it as a less
powerful, but more convenient, version of your database&#8217;s command-line
utility.</li>
<li><em>Quick and dirty data-management apps</em>: You can use the admin site to
build yourself a very lightweight data management app &#8211; say, to keep
track of expenses. If you&#8217;re just building something for your own needs,
not for public consumption, the admin site can take you a long way. In
this sense, you can think of it as a beefed up, relational version of a
spreadsheet.</li>
</ul>
<p>One final point we want to make clear is: the admin site is not an
end-all-be-all. Over the years, we&#8217;ve seen it hacked and chopped up to serve a
variety of functions it wasn&#8217;t intended to serve. It&#8217;s not intended to be a
<em>public</em> interface to data, nor is it intended to allow for sophisticated
sorting and searching of your data. As we said early in this chapter, it&#8217;s for
trusted site administrators. Keeping this sweet spot in mind is the key to
effective admin-site usage.</p>
</div>
<div class="section" id="what-s-next">
<h2>What&#8217;s Next?</h2>
<p>So far we&#8217;ve created a few models and configured a top-notch interface for
editing data. In the next chapter <a class="reference external" href="chapter07.html">Chapter 7</a>, we&#8217;ll move on to the real &#8220;meat and potatoes&#8221;
of Web development: form creation and processing.</p>
</div>
</div>
</div>

          </div>
        </div>
      </div>
      <div id="ft">
        
<div class="nav">
    
        <a href='chapter05.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='chapter07.html'>next &raquo;</a>
    
</div>

        Copyright Adrian Holovaty, Jacob Kaplan-Moss, et al.<br>This
        work is licensed under the <a href="license.html">GNU Free Document
        License</a>.
      </div>
    </div>
  
  </body>
</html>